-- add k.skowronski 2005

----- 1. 
----- number of employees (contract)
select count(*) from ek_pracownicy, ek_zatrudnienie 
where zat_prc_id=prc_id
and ek_zatrudnienie.zat_data_zmiany = (
	 select max(zat_data_zmiany) from ek_zatrudnienie 
	 where zat_prc_id = prc_id
	 and zat_typ_umowy = 0 
	 and zat_data_zmiany <= last_day(to_date(:data_do,'MM-YYYY') ))
	 --
	 and (ek_zatrudnienie.zat_data_do >= to_date(:data_do,'MM-YYYY')
	 or ek_zatrudnienie.zat_data_do is null)
	 and zat_typ_umowy = 0

-- shorter version  - KS 2012-06-26
select count(distinct prc_id) from ek_zatrudnienie, ek_pracownicy where
(NVL(zat_data_do, to_date('2099', 'YYYY')) >= to_date('2012-01', 'YYYY-MM')
and zat_data_zmiany <= last_day(to_date('2012-01', 'YYYY-MM')))
and zat_typ_umowy = 0
and zat_prc_id = prc_id;

-- 2. 
-- number of employees (freelance)
select * from ek_zatrudnienie, ek_pracownicy, ek_etapy_umowy  where
(NVL(zat_data_do, to_date('2099', 'YYYY')) >= to_date('2014-03', 'YYYY-MM')
and zat_data_zmiany <= last_day(to_date('2014-03', 'YYYY-MM')))
and zat_typ_umowy != 0
and eu_Zat_id = zat_id
and eu_miesiac = '2014-03-01'
and zat_prc_id = prc_id;


